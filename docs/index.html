<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BAUZA GPT ‚Äî B√∫squeda Premium</title>
  <meta name="description" content="B√∫squeda OSINT Premium con entrega en PDF/ZIP y enlaces verificados."/>
  <link rel="icon" href="./img/ojos-vigilantes.gif"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --bauza:#22c55e; --bg:#0a0f1e; --card:#0f172a; --line:#1f2937 }
    html,body{height:100%}
    body{background:radial-gradient(1200px 800px at 50% -10%, rgba(34,197,94,.10), transparent),
         linear-gradient(180deg, #0a0f1e 0%, #060a14 100%); color:#cbd5e1;
         font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto}
    .wrap{min-height:100%;display:flex;flex-direction:column}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--line)}
    .brand{display:flex;align-items:center;gap:12px}
    .brand .logo{width:36px;height:36px;border-radius:10px;overflow:hidden;border:1px solid #1f2937}
    .matrix {background:linear-gradient(90deg, #16a34a, #a7f3d0); -webkit-background-clip:text; background-clip:text; color:transparent}
    .panel{width:min(960px,100%);margin-inline:auto}
    .card{background:rgba(15,23,42,.6);border:1px solid #1f2937;border-radius:18px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
    .inner{padding:22px}
    .badge{display:inline-block;border:1px solid #334155;border-radius:999px;padding:4px 10px;font-size:12px;color:#9ca3af}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:14px;border:1px solid #2a3342;background:#0b1323;font-weight:700}
    .btn:hover{outline:1px solid rgba(34,197,94,.35)}
    .btn-green{ border-color:#14532d; background:linear-gradient(180deg,#052e16,#081b12); color:#d1fae5 }
    .price{font-size:34px;font-weight:900;color:#a7f3d0}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono"}
    .link{color:#a7f3d0;text-decoration:underline}
    .row{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:800px){ .row{grid-template-columns:1fr 1fr} }
    input, textarea{
      background:#0b1020;border:1px solid #334155;border-radius:12px;padding:10px 12px;color:#e2e8f0;width:100%
    }
    label{font-size:13px;opacity:.9;margin-bottom:6px;display:block}
    .muted{opacity:.75}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo"><img src="./img/ojos-vigilantes.gif" alt="BAUZA" class="w-full h-full object-cover"></div>
      <h1 class="matrix text-xl font-extrabold">BAUZA GPT</h1>
      <span class="badge mono">B√∫squeda Premium</span>
    </div>
    <nav class="flex items-center gap-2">
      <a class="badge" href="./privacidad.html">Privacidad</a>
      <a class="badge" href="./terminos.html">T√©rminos</a>
      <button id="btnCfg" class="badge">‚öôÔ∏è Config</button>
    </nav>
  </header>

  <main class="panel p-4 md:p-6 space-y-4">
    <!-- STATUS -->
    <section class="card">
      <div class="inner text-sm">
        <span class="text-green-400">‚óè</span> Flujo Premium activo. Crea la orden, paga y descarga tu PDF con enlaces verificados (&lt;400).
        <span class="mono">v1-front</span>
      </div>
    </section>

    <!-- FORMULARIO PREMIUM -->
    <section class="card">
      <div class="inner space-y-4">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-xl font-extrabold">Plan Premium</h2>
            <p class="muted">B√∫squeda OSINT ampliada (hasta 3 objetos). Entrega en PDF/ZIP con enlaces validados.</p>
          </div>
          <div class="text-right">
            <div class="price">$20 MXN</div>
            <div class="text-xs muted">Descarga segura + opci√≥n por correo.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="email">Correo del cliente</label>
            <input id="email" type="email" placeholder="cliente@correo.com" autocomplete="email" />
          </div>
          <div>
            <label for="target">Target (correo, usuario, tel√©fono o URL)</label>
            <input id="target" type="text" placeholder="@usuario | correo@dominio | +52XXXXXXXXXX | https://..." />
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button id="btnPremium" class="btn btn-green">üîé Comprar & Generar (Premium)</button>
          <button id="btnVerify" class="btn" disabled>‚úÖ Ya pagu√©, verificar</button>
          <a id="btnDownload" class="btn hidden" href="#" download>‚¨áÔ∏è Descargar PDF</a>
        </div>

        <div id="msg" class="text-sm muted"></div>
        <div id="payBox" class="hidden mt-2 p-3 rounded-lg border border-slate-700 bg-slate-900/40"></div>
      </div>
    </section>

    <!-- CONFIG -->
    <section id="cfgSection" class="card hidden">
      <div class="inner space-y-3">
        <h3 class="font-bold">Configuraci√≥n local</h3>
        <div class="row">
          <div>
            <label for="apiBase">URL de tu backend (Render/Railway/Heroku)</label>
            <input id="apiBase" type="text" placeholder="https://TU-BACKEND.com" />
          </div>
          <div>
            <label>&nbsp;</label>
            <button id="btnSaveCfg" class="btn">üíæ Guardar</button>
          </div>
        </div>
        <p class="text-xs muted">Se guarda en <span class="mono">localStorage.API_BASE</span>. No expongas secretos en el front.</p>
      </div>
    </section>

    <!-- AYUDA -->
    <section class="card">
      <div class="inner text-xs muted">
        ¬øDudas? Tras pagar, usa <b>‚ÄúYa pagu√©, verificar‚Äù</b>. Cuando el backend marque la orden como <b>ready</b>, aparecer√°
        el bot√≥n <b>Descargar PDF</b>. Si pagaste y no cambia, el admin debe llamar a <span class="mono">POST /api/admin/mark-paid</span>.
      </div>
    </section>
  </main>

  <footer class="p-4 text-center text-xs muted">
    ¬© <span id="year"></span> BAUZA GPT ‚Äî Hecho con <span class="text-green-400">OSINT</span> en M√©xico.
  </footer>
</div>

<script>
(function(){
  const $ = (q)=>document.querySelector(q);
  const msg = (t)=> $("#msg").textContent = t || "";
  const store = {
    get api(){ return localStorage.getItem("API_BASE") || "" },
    set api(v){ localStorage.setItem("API_BASE", (v||"").replace(/\/+$/,"")) },
    saveOrder(o){ localStorage.setItem("BAUZA_LAST_ORDER", JSON.stringify(o||{})) },
    loadOrder(){ try{ return JSON.parse(localStorage.getItem("BAUZA_LAST_ORDER")||"{}") } catch(e){ return {} } }
  };

  // UI
  $("#year").textContent = new Date().getFullYear();
  $("#btnCfg").onclick = ()=> $("#cfgSection").classList.toggle("hidden");
  $("#btnSaveCfg").onclick = ()=>{
    const v = $("#apiBase").value.trim();
    store.api = v;
    msg("‚úÖ Backend guardado: " + (store.api || "(vac√≠o)"));
  };
  // Precargar campo config
  $("#apiBase").value = store.api;

  async function api(path, opts={}){
    const base = store.api;
    if(!base){ throw new Error("Configura tu backend en ‚öôÔ∏è Config") }
    const url = base + path;
    const res = await fetch(url, { headers:{ "Content-Type":"application/json" }, ...opts });
    const json = await res.json().catch(()=> ({}));
    if(!res.ok) throw new Error(json.message || ("Error HTTP "+res.status));
    return json;
  }

  function renderPayBox(order){
    const box = $("#payBox");
    const methods = order.methods || [];
    box.innerHTML = `
      <div class="text-sm">
        <div><b>Orden:</b> <span class="mono">${order.orderId}</span></div>
        <div><b>Referencia:</b> <span class="mono">${order.payRef || "-"}</span></div>
        <div><b>Monto:</b> ${order.amount} ${order.currency}</div>
      </div>
      <div class="mt-2">
        <div class="font-bold mb-1">M√©todos de pago:</div>
        <ul class="list-disc pl-5 space-y-1">
          ${methods.map(m=> `<li><b>${m.name}:</b> ${m.instructions}</li>`).join("")}
        </ul>
      </div>
    `;
    box.classList.remove("hidden");
  }

  // Crear orden Premium
  $("#btnPremium").onclick = async ()=>{
    try{
      msg("");
      const email = $("#email").value.trim();
      const target = $("#target").value.trim();
      if(!email || !email.includes("@")) return msg("‚ö†Ô∏è Ingresa un correo v√°lido.");
      if(!target) return msg("‚ö†Ô∏è Ingresa el target a investigar.");

      const resp = await api("/api/orders", {
        method:"POST",
        body: JSON.stringify({ plan:"premium", email })
      });

      // Guardamos localmente el target para usarlo en el paso 2 (generaci√≥n real)
      const order = {
        orderId: resp.orderId,
        orderToken: resp.orderToken,
        email, plan:"premium",
        target,
        amount: resp.amount, currency: resp.currency,
        payRef: resp.payRef
      };
      store.saveOrder(order);

      renderPayBox(resp);
      $("#btnVerify").disabled = false;
      $("#btnDownload").classList.add("hidden");
      msg("üßæ Orden creada. Realiza el pago con alguna opci√≥n y luego pulsa ‚ÄúYa pagu√©, verificar‚Äù.");
    }catch(e){
      msg("‚ùå " + e.message);
    }
  };

  // Verificar estado (poll simple)
  let polling = null;
  $("#btnVerify").onclick = async ()=>{
    const ord = store.loadOrder();
    if(!ord.orderId) return msg("‚ö†Ô∏è Crea primero la orden premium.");
    msg("‚åõ Verificando pago / generaci√≥n de PDF...");
    $("#btnVerify").disabled = true;

    const check = async ()=>{
      try{
        const st = await api(`/api/orders/${ord.orderId}/status?token=${encodeURIComponent(ord.orderToken||"")}`);
        if(st.status === "ready"){
          clearInterval(polling); polling = null;
          msg("‚úÖ PDF listo. Puedes descargarlo.");
          const dl = $("#btnDownload");
          dl.href = `${store.api}/api/orders/${ord.orderId}/download?token=${encodeURIComponent(ord.orderToken||"")}`;
          dl.classList.remove("hidden");
          $("#btnVerify").disabled = false;
        }else{
          msg(`‚åõ Estado: ${st.status}. Seguimos verificando‚Ä¶`);
        }
      }catch(e){
        msg("‚ùå " + e.message);
        $("#btnVerify").disabled = false;
        clearInterval(polling); polling = null;
      }
    };

    await check();
    if(!polling) polling = setInterval(check, 4000);
  };
})();
</script>
</body>
</html>
