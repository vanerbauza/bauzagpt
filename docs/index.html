<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>bauzaGPT</title>

  <!-- No colocar "legal" en el front. Mantener misterio y autoridad. -->
  <meta name="description" content="Búsqueda OSINT con entrega en PDF — BauzaGPT" />

  <!-- Content Security Policy - ejemplo base. AJUSTA desde tu servidor/Cloudflare a necesidades reales.
       No incluyas claves en el HTML. -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; connect-src 'self' https:; img-src 'self' data:; style-src 'self' 'unsafe-inline';">

  <style>
    /* Reset minimal */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    :root{
      --bg:#060405;
      --card:#0f0e0f;
      --muted:#c6c6c6;
      --accent:#ff3b3b; /* rojo fuerte para acento */
      --accent-2:#ff6f6f;
      --glass: rgba(255,255,255,0.03);
    }

    body{
      background: radial-gradient(900px 600px at 50% -10%, #120a15 0%, #070607 40%, #020202 100%);
      color: #eee;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Contenedor principal */
    .container{
      max-width:1200px;
      margin: 32px auto;
      padding: 24px;
      position:relative;
    }

    /* Header: logo y botón acceso */
    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      margin-bottom:32px;
    }
    .brand{
      font-size:88px;
      font-weight:800;
      letter-spacing: -4px;
      color: var(--accent);
      text-shadow: 0 6px 30px rgba(255,59,59,0.12);
      margin:0;
    }

    .btn-google{
      background: linear-gradient(180deg,#b23b3b,#8b2a2a);
      color:white;
      padding:12px 20px;
      border-radius:12px;
      border:none;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .btn-google:active{ transform: translateY(1px); box-shadow: 0 3px 8px rgba(0,0,0,0.6); }

    /* Hero - barra de búsqueda y ojos */
    .hero{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:18px;
      margin-top:8px;
    }
    .search-wrap{
      position:relative;
      width:72%;
      max-width:820px;
      min-width:320px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .search-input{
      width:100%;
      padding:18px 56px;
      border-radius:28px;
      border:none;
      background: linear-gradient(180deg, #ffffff10, #00000010);
      color:#ddd;
      font-size:18px;
      outline:none;
      box-shadow: 0 8px 40px rgba(0,0,0,0.6), inset 0 -2px 8px rgba(255,255,255,0.02);
    }
    .search-icon{
      position:absolute;
      left:18px;
      width:28px;
      height:28px;
      opacity:0.9;
      filter: invert(1) brightness(0.85);
    }
    .premium-badge{
      margin-top:12px;
      background: rgba(10,10,10,0.6);
      border: 2px solid rgba(255,59,59,0.9);
      padding:14px 24px;
      border-radius:12px;
      font-weight:800;
      color:var(--accent);
      box-shadow: 0 18px 60px rgba(255,59,59,0.08);
      cursor:pointer;
    }

    /* OJOS VIGILANTES - decorativo */
    .eyes{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      width:880px;
      height:320px;
      top:160px;
      pointer-events:none;
      mix-blend-mode:screen;
      opacity:0.9;
      filter: blur(10px) saturate(1.3);
    }

    /* Sección pasos - deslizable */
    .steps{
      margin-top:420px; /* espacio para hero */
      padding:48px 24px;
      background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(2,2,2,0.95));
      border-top:1px solid rgba(255,255,255,0.02);
      border-bottom:1px solid rgba(255,255,255,0.02);
    }
    .steps-grid{
      max-width:1000px;
      margin:0 auto;
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:28px;
      align-items:start;
    }
    .step{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:18px;
      text-align:center;
      box-shadow: 0 8px 28px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.02);
    }
    .step h3{ margin:10px 0 8px; color:var(--accent); }
    .step p{ color:var(--muted); font-size:14px; line-height:1.3; margin:0 0 12px; }
    .step img{
      width:100%;
      height:160px;
      object-fit:cover;
      border-radius:8px;
      background: #111;
      display:block;
      margin-bottom:12px;
    }
    .step .note{ font-size:12px; color:#aaa; }

    /* Footer breve */
    footer{
      text-align:center;
      padding:28px 8px;
      color:#999;
      font-size:13px;
    }

    /* Responsive */
    @media (max-width:900px){
      .brand{ font-size:64px }
      .search-wrap{ width:88% }
      .eyes{ width:600px; top:120px; height:240px }
      .steps-grid{ grid-template-columns: 1fr; gap:18px; }
      .steps{ margin-top:300px; }
    }

    /* Smooth scroll anchor */
    html{ scroll-behavior: smooth; }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <h1 class="brand" aria-label="Bauza G P T">bauzaGPT</h1>

      <!--
        BOTÓN DE ACCESO:
        - Este botón debe abrir el flujo de autenticación REAL en tu backend.
        - NO pongas client_id ni secrets aquí.
        - Ideal: abrir POST a /auth/start (backend) que redirige a Google y guarda estado seguro en servidor.
      -->
      <button class="btn-google" id="btn-google" aria-label="Acceso con Google">
        Acceso con Google
      </button>
    </header>

    <section class="hero" aria-labelledby="busqueda">
      <div class="search-wrap" role="search" aria-labelledby="busqueda">
        <img src="/img/lupa.svg" alt="" class="search-icon" aria-hidden="true" />
        <input id="input-target" class="search-input" placeholder="Buscar persona, teléfono o usuario" aria-label="Campo de búsqueda" />
      </div>

      <div class="premium-badge" id="btn-premium" role="button" tabindex="0" aria-pressed="false">
        Búsqueda Premium — 20 MXN
      </div>

      <!-- OJOS VIGILANTES: imagen decorativa (usa PNG/GIF que ya tienes). pointer-events none -->
      <img class="eyes" src="/img/ojos-vigilantes.png" alt="" aria-hidden="true" />
    </section>

    <!-- SECCIÓN DESLIZABLE: tres pasos. -->
    <section class="steps" id="como-funciona" aria-label="Cómo funciona">
      <div style="text-align:center; margin-bottom:18px;">
        <h2 style="color:var(--accent); margin:0; font-size:28px;">Cómo funciona (3 pasos)</h2>
        <p style="color:var(--muted); margin-top:6px;">Rápido. Seguro. Resultados en PDF.</p>
      </div>

      <div class="steps-grid" role="list">
        <!-- Paso 1 -->
        <article class="step" role="listitem" aria-labelledby="paso1">
          <!-- Reemplaza /img/step1.png por la captura real de tu sitio (optimizada) -->
          <img data-src="/img/step1.png" alt="Acceso con cuenta Google — captura" loading="lazy" />
          <h3 id="paso1">1. Acceso con Google</h3>
          <p>Inicia sesión con tu cuenta. El proceso de autenticación se maneja en nuestro servidor — tus credenciales NUNCA se exponen en el navegador.</p>
          <div class="note">Captura de tu propia página — subir en /img/step1.png</div>
        </article>

        <!-- Paso 2 -->
        <article class="step" role="listitem" aria-labelledby="paso2">
          <img data-src="/img/step2.png" alt="Compra de paquete de créditos — captura" loading="lazy" />
          <h3 id="paso2">2. Compra de créditos</h3>
          <p>Compra el paquete que necesites. El pago lo procesamos vía backend seguro (Stripe o método configurado) y tú recibes confirmación y crédito en tu cuenta.</p>
          <div class="note">Captura de tu pantalla de pago — subir en /img/step2.png</div>
        </article>

        <!-- Paso 3 -->
        <article class="step" role="listitem" aria-labelledby="paso3">
          <img data-src="/img/step3.png" alt="PDF de resultados — captura" loading="lazy" />
          <h3 id="paso3">3. PDF de resultados</h3>
          <p>Una vez validado el pago, el sistema genera y entrega un PDF con evidencia y enlaces verificados. Tú decides si descargar o recibir por correo.</p>
          <div class="note">Captura del PDF generado — subir en /img/step3.png</div>
        </article>
      </div>
    </section>

    <footer>
      <div>© <strong>bauzaGPT</strong> — Protegiendo la verdad y cuidando a los indefensos.</div>
    </footer>
  </div>

  <script>
    /**
     * NOTAS IMPORTANTES DE SEGURIDAD (leer y aplicar en backend):
     * - El frontend nunca debe contener keys/IDs sensibles.
     * - OAuth: iniciar desde backend (/auth/start) y usar server-side exchange para tokens.
     * - Pagos: el checkout debe ejecutarse desde backend o usando Stripe Checkout/Payment Links (servidor crea sesión).
     * - Generación PDF: realizarla en servidor y almacenar/incluir enlaces temporales firmados (presigned URLs).
     * - Todas las conexiones a APIs externas deben pasar por tu servidor que tenga las variables de entorno.
     *
     * En el HTML sólo exponemos endpoints seguros (sin secrets). A continuación el ejemplo de cómo invocar endpoints
     * que ya debes tener montados en tu backend:
     *
     *  - POST /auth/start        -> inicia flujo OAuth (backend guarda state, redirige a Google)
     *  - POST /purchase/create   -> crea sesión de pago (backend responde con URL de checkout)
     *  - POST /search/run        -> request para lanzar la búsqueda (backend valida créditos y crea job)
     *  - GET  /reports/:id       -> descarga segura del PDF (token temporal)
     *
     * Asegúrate de CORS restricto y de que connect-src y fetch solo apunten a tus dominios.
     */

    // Elementos
    const btnGoogle = document.getElementById('btn-google');
    const btnPremium = document.getElementById('btn-premium');
    const inputTarget = document.getElementById('input-target');

    // Event: abrir el flujo de autorización (delegado al backend)
    btnGoogle.addEventListener('click', async () => {
      try {
        // Llamada *segura* al backend que inicia OAuth. NO pongas client_id aquí.
        // Backend debe devolver redirect URL o redirigir directamente.
        const res = await fetch('/auth/start', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include' // cookies seguras si usas sesión server-side
        });
        if (res.ok) {
          // si el backend responde con una URL donde redirigir:
          const data = await res.json();
          if (data.redirect) return window.location.href = data.redirect;
          // si backend hizo redirección, puede responder 204; no hagas nada
        } else {
          console.error('Error iniciando autenticación', res.status);
          alert('No se pudo iniciar sesión. Intenta más tarde.');
        }
      } catch (e) {
        console.error(e);
        alert('Error de conexión al servidor.');
      }
    });

    // Event: premium -> abre modal de compra (ejemplo: backend crea sesión de pago)
    btnPremium.addEventListener('click', async () => {
      try {
        const res = await fetch('/purchase/create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ sku: 'premium_20mxn' })
        });
        const body = await res.json();
        if (res.ok && body.checkoutUrl) {
          window.location.href = body.checkoutUrl; // redirect al checkout seguro
        } else {
          alert('No se pudo iniciar el proceso de pago.');
          console.error(body);
        }
      } catch (err) {
        console.error(err);
        alert('Error al conectar con el servidor de pagos.');
      }
    });

    // Buscar: ejemplo de cómo lanzar una búsqueda (se
